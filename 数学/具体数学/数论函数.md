以下记 $\mathbf{P}$ 为质数集。 
## 狄利克雷卷积

定义关于**数论函数**的狄利克雷卷积为：  
$(f*g)(n)=\displaystyle\sum_{d|n}f(d)g(\frac{n}{d})=\sum_{d|n}f(\frac{n}{d})g(d)=\sum_{xy=n}f(x)g(y)\ (n,d,x,y\in\mathbf{N})$  
按定义求是 $\Theta(n\log n)$ 的，与积性函数作卷积可用 FWT 优化到 $\Theta(n\log\log n)$。  

### 狄利克雷卷积的性质

- $f*g=g*f,(f*g)*h=f*(g*h)$ （交换律和结合律）
- $(f+g)*h=f*h+g*h,(kf)*g=k(f*g)$（分配律和相容性）  
- $f*[x=1]=[x=1]*f=f$ （单位元）  
- 对于任意数论函数 $f$，若 $f(1)\not =0$，则必存在 $f^{-1}$，  
  使得 $f*f^{-1}=f^{-1}*f=[x=1]$（逆元）。
  > 证明：考虑构造出 $f^{-1}$。首先 $f^{-1}(1)=\dfrac{1}{f(1)}$。  
  >$\qquad\forall n\ge 2,(f^{-1}*f)(n)=\displaystyle\sum_{d|n}f^{-1}(d)f(\dfrac{n}{d})$   
  > $\displaystyle\qquad=f^{-1}(n)f(1)+\sum_{d|n,d\not =n}f^{-1}(d)f(\dfrac{n}{d})=[n=1]=0$  
  > $\qquad$ 因此 $\forall n\ge 2,f^{-1}(n)=\displaystyle\dfrac{-1}{f(1)}\sum_{d|n,d\not =n}f^{-1}(d)f(\dfrac{n}{d})$，由此得到 $f^{-1}$ 的递推式。

  已知 $f$，递推出 $f^{-1}$ 是 $\Theta(n\log n)$ 的。

-------------------------
## 积性函数  
对于 $\mathbf{N}_+\rightarrow\mathbf{C}$ 的函数 $f(x)$，
- $\forall \gcd(a,b)=1,f(ab)=f(a)f(b)$ 时，$f(x)$ 为积性函数。
- $\forall a,b\in\mathbf{N_+},f(ab)=f(a)f(b)$ 时，$f(x)$ 为完全积性函数。    

### 积性函数的性质

- 对于任意积性函数 $f$，有 $f(1)=\begin{cases}1&(f\not =0)\\0&(f=0)\end{cases}$。  
  > 证明：由积性函数性质得 $f(1)f(1)=f(1),f(1)(f(1)-1)=0$。  
  > $\qquad$ 因此 $f(1)$ 的值只能为 $1$ 或 $0$。  
  > - 若 $f(1)=1,\forall x\in\mathbf{N}_+,f(x)=f(1)f(x)=1\times f(x)$，满足积性函数性质。
  > - 否则，$\forall x\in\mathbf{N}_+,f(x)=f(1)f(x)=0$，因此 $f=0$。  
  > 
  >   证毕。
- 对于积性函数 $f$，设 $f_{(p)}(x)=\begin{cases}f(x)&(\exist k,x=p^k)\\0&(\forall k,x\not=p^k)\end{cases}$，则 $f=\displaystyle\prod_{p\in\mathbf{P}}f_{(p)}$。  
  反之，若 $\forall x\not =p^k,f_{(p)}(x)=0$，则 $\displaystyle f=\prod_{p\in\mathbf{P}}f_{(p)}$ 为积性函数。（唯一分解定理）    
  记 $f_{p,k}=f(p^k)$，则 $\displaystyle f_p(x)=\sum_{k=0}^\infty f_{p,k}x^k$ 称为 $f$ 模 $p$ 的贝尔级数。
- 对于积性函数 $f,g,f*g$ 为积性函数。（积性函数的封闭性）
  > 证明：$p^i\times p^j=p^{i+j}$，因此 $\forall x\not =p^k,(f_{(p)}*g_{(p)})(x)=0$。于是  
  > $\qquad f*g=\displaystyle(\prod_{p\in\mathbf{P}}f_{(p)})*(\prod_{p\in\mathbf{P}}g_{(p)})=\prod_{p\in\mathbf{P}}f_{(p)}*g_{(p)}=\prod_{p\in\mathbf{P}}(f*g)_{(p)}$ 为积性函数。
- 对于积性函数 $f\not=0,f^{-1}$ 为积性函数。  
  > 证明：$f^{-1}=\displaystyle(\prod_{p\in\mathbf{P}}f_{(p)})^{-1}=\prod_{p\in\mathbf{P}}(f_{(p)})^{-1}$。  
  > $\qquad$ 又已知 $(f_{(p)}*g_{(p)})_p=f_p\times g_p$，因此 $(f_{(p)})^{-1}=(f^{-1})_{(p)}=f_{(p)}^{-1}$，证毕。
  
  积性函数求逆是 $\Theta(n\log\log n)$ 的。

### 常见的积性函数

常见的完全积性函数： $x,1,0,[x=1],x^n$。


$\varphi(x)$（欧拉函数）： $x$ 及 $x$ 以下与 $x$ 互质的数的个数。  
$\varphi(1)=1,\varphi(p)=p-1$ （显然）   
对于质数 $p$，
- 若 $p\nmid x$，则 $\varphi(px)=(p-1)\varphi(x)$
- 否则， $\varphi(px)=p\varphi(x)$  

证明详见狄利克雷生成函数。   
欧拉定理： $\gcd(a,m)=1$ 时， $a^{\varphi(m)}\equiv 1\pmod m$  
扩展欧拉定理： $b\ge m$ 时，$a^b\equiv a^{(b\bmod\varphi(m))+\varphi(m)}\pmod m$

$\mu(x)$（莫比乌斯函数）：$1$ 关于狄利克雷卷积的逆元。  
- $\mu(1)=1$  
- $\mu(\displaystyle\prod_{i=1}^n p_i)=(-1)^n$（$p_i$ 为质数，且两两不同）
- $\mu\left(\displaystyle\prod_{i=1}^n p_i^{k_i}\right)=0$（存在 $k_i\ge 2$）

$d(x)$：$x$ 的约数个数。  
若分解质因数后 $x=\displaystyle\prod_{i=1}^n p_i^{k_i}$，则 $d(x)=\displaystyle\prod_{i=1}^n(k_i+1)$ （dp 可证）
- 增长率：$d(x)=\Omicron(n^\frac{1.066}{\ln\ln n})$

$\sigma(x)$：$x$ 的所有正约数的和。

若分解质因数后 $x=\displaystyle\prod_{i=1}^n p_i^{k_i}$，则 $\sigma(x)=\displaystyle\prod_{i=1}^n\frac{p_i^{k_i+1}-1}{p_i-1}$（dp 可证）
- 增长率（黎曼猜想成立时）：$\sigma(n)<e^{\gamma}n\ln\ln n\ (n>5040)$

----------------------
## 狄利克雷生成函数

对于数论函数 $f$，记 $\operatorname{DGF}f=\displaystyle\sum_{k=1}^\infty \dfrac{f(k)}{k^x}$ 为其狄利克雷生成函数。

### 狄利克雷生成函数的性质

- $\operatorname{DGF}(f*g)=\operatorname{DGF} f \times \operatorname{DGF} g$
- $\operatorname{DGF}(f+g)=\operatorname{DGF}f+\operatorname{DGF} g,\operatorname{DGF} kf=k\operatorname{DGF} f$ 
- $(\operatorname{DGF}(x^nf))(x)=(\operatorname{DGF} f)(x-n)$
- $(\operatorname{DGF} f)'=f(1)-\displaystyle\sum_{k=2}^\infty\dfrac{f(k)}{k^x}\ln k,\int(\operatorname{DGF}f)(x)\mathrm{d}x=f(1)-\sum_{k=2}^\infty\dfrac{f(k)}{k^x\ln k }$  
  实际操作中常用质因子次数和代替 $\ln$。  
  $\ln\operatorname{DGF}f,e^{\operatorname{DGF}f}$ 基于此实现。
### 常见的狄利克雷生成函数

- $\operatorname{DGF} 1=\zeta(x),\zeta(x)$ 为黎曼函数。
- $\operatorname{DGF}\mu=\zeta^{-1}(x)$。
  > 证明：即证明 $1*\mu=\mu*1=[x=1]$。  
  > $\qquad (1)_p(x)=\dfrac{1}{1-x},(1)^{-1}_p(x)=1-x$  。  
  > $\qquad$ 因此 $(1)_{(p)}^{-1}(p^k)=(-1)^k[k\le 1]$。  
  > $\qquad$ 于是 $(1)^{-1}=\displaystyle\prod_{p\in\mathbf{P}}(1)_{(p)}^{-1}=\mu$。
- $\operatorname{DGF} x^n=\zeta(x-n)$。  
- $\operatorname{DGF}(x^n\mu(x))=\zeta^{-1}(x-n)$。
- $\operatorname{DGF}d=\zeta^2(x)$
- $\operatorname{DGF}\sigma_k=\zeta(x-k)\zeta(x)$，其中 $\sigma_k(n)=\displaystyle\sum_{d|n}d^k$。  

- $\operatorname{DGF}\varphi=\dfrac{\zeta(x-1)}{\zeta(x)}$
  > 证明：即证明 $\varphi*1=1*\varphi=x$。  
  > 设 $f_n(x)=\displaystyle\sum_{k=1}^n[\gcd(n,k)=x]$，则肯定有 $n=\displaystyle\sum_{k=1}^nf_n(k)$  
  注意到 $[\gcd(n,k)=x]={\begin{cases}0&(x\nmid n\texttt{ 或 }x\nmid k)\\{[\gcd(\dfrac{n}{x},\dfrac{k}{x})=1]}&(x\mid n\texttt{ 且 }x\mid k)\end{cases}}$  
  因此 $f_n(x)={\begin{cases}0&(x\nmid n)\\{\displaystyle\sum_{k|x\texttt{且}k\in[1,n]}[\gcd(\dfrac{n}{x},\dfrac{k}{x})=1]}&(x\mid n)\end{cases}}$  
  于是 $x\mid n$ 时，$f_n(x)\displaystyle=\sum_{k=1}^\frac{n}{x}[\gcd(\dfrac{n}{x},k)=1]=\varphi(\frac{n}{x})$  
  那么必有 $\displaystyle n=\sum_{k=1}^nf_n(k)=\sum_{k|n}f_n(k)=\sum_{k|n}\varphi(\frac{n}{k})$  
  因此 $x=\varphi*1=1*\varphi$  

  > 推论（欧拉函数通项公式）：  
  > $$\varphi(n)=(x*\mu)(n)=\displaystyle\sum_{k|n}\frac{n}{k}\mu(k)$$  
  > 设 $n$ 的质因子组成的集合为 $S$，则 
  > $$\varphi(n)=\sum_{T\subseteq S}(-1)^{|T|}\prod_{p\in S\texttt{且}p\notin T}p=n\sum_{T\subseteq S}\prod_{p\in T}\frac{1}{-p}$$
  > 每种质因子在 $T$ 中只有两种可能：选或不选，考虑 dp，则有
  > $$\varphi(n)=n\sum_{T\subseteq S}\prod_{p\in T}\frac{1}{-p}=n\prod_{p\in S}(1-\frac{1}{p})$$
  > 由此得到 $\varphi$ 的通项公式。

-------------------------
## 杜教筛
对于积性函数 $f$，要求 $S(n)=\displaystyle\sum_{k=1}^nf(k)$  
另外找一个积性函数 $g$，可得  
$$\sum_{k=1}^n(g*f)(k)=\displaystyle\sum_{k=1}^n\sum_{d|k}g(d)f(\frac{k}{d})=\sum_{d=1}^ng(d)\sum_{k=1}^{\lfloor\frac{n}{d}\rfloor}f(k)=\sum_{d=1}^ng(d)S({\left\lfloor\frac{n}{d}\right\rfloor})$$
$$S(n)=g(1)S(n)=\sum_{d=1}^ng(d)S({\left\lfloor\frac{n}{d}\right\rfloor})-\sum_{d=2}^ng(d)S({\left\lfloor\frac{n}{d}\right\rfloor})$$
$$=\sum_{k=1}^n(g*f)(k)-\sum_{d=2}^ng(d)S({\left\lfloor\frac{n}{d}\right\rfloor})$$

若 $g(x),\displaystyle\sum_{k=1}^n(g*f)(k)$ 可快速计算，就可数论分块求解。

### $\varphi,\mu$ 的杜教筛
已知 $\varphi*1=1*\varphi=x,\mu*1=1*\mu=[x=1]$，此时   
$$S_\varphi(n)=\displaystyle\sum_{k=1}^nk-\sum_{d=2}^nS_\varphi({\left\lfloor\frac{n}{d}\right\rfloor})=\frac{n}{2}(n+1)-\sum_{d=2}^nS_\varphi({\left\lfloor\frac{n}{d}\right\rfloor})$$
$$S_\mu(n)=\sum_{k=1}^n[k=1]-\sum_{d=2}^nS_\mu({\left\lfloor\frac{n}{d}\right\rfloor})=1-\sum_{d=2}^nS_\mu({\left\lfloor\frac{n}{d}\right\rfloor})$$
----------------------
## Min_25 筛
规定以下记号：
- $\operatorname{lpf} n$：$n$ 的最小质因子。
- $\mathbf{P}_k$：第 $k$ 个质数。

对于积性函数 $f$，要求 $S(n)=\displaystyle\sum_{k=2}^nf(k)$。

设 $S_k(n)=\displaystyle\sum_{p=2}^n[\operatorname{lpf}p\ge\mathbf{P}_k]f(p)$，显然 $S(n)=S_1(n)+1$

又设 $S_{\mathbf{P}}(n)=\displaystyle\sum_{p=2}^n[p\in\mathbf{P}]f(p)$，则 $\forall\mathbf{P}_k^2>n,S_k(n)=S_{\mathbf{P}}(n)-S_{\mathbf{P}}(\mathbf{P}_{k-1})$    
考虑递推 $S_k$，枚举最小质因子，有：

$$S_k(n)=\sum_{\small i\ge k\atop\mathbf{P}_i\le n}f(\mathbf{P}_i)+\sum_{\small i\ge k\atop \mathbf{P}_i^2\le n}\sum_{\small c\ge 1\atop \mathbf{P}_i^c\le n}f(\mathbf{P}_i^c)([c>1]+S_{k+1}(\lfloor\dfrac{n}{\mathbf{P}_i^c}\rfloor))$$
注意到若 $\mathbf{P}_i^c\le n<\mathbf{P}_i^{c+1}$，则 $\lfloor\dfrac{n}{\mathbf{P}_1^{c+1}}\rfloor=0$，因此
$$S_k(n)=S_{\mathbf{P}}(n)-S_{\mathbf{P}}(\mathbf{P}_{k-1})+\sum_{\small i\ge k\atop \mathbf{P}_i^2\le n}\sum_{\small c\ge 1\atop \mathbf{P}_i^{c+1}\le n}(f(\mathbf{P}_i^{c})S_{k+1}(\lfloor\dfrac{n}{\mathbf{P}_i^{c}}\rfloor)+f(\mathbf{P}_i^{c+1}))$$

若可快速求出 $S_{\mathbf{P}}(n)$，则可按照递推式快速计算出 $S_k(n)$。

另取一**数论函数** $g(n)$，使 $g(\mathbf{P}_i^c)=f(\mathbf{P}_i^c)$ 。

设 $g_0(n)=\displaystyle\sum_{p=2}^ng(p),g_k(n)=\sum_{p=2}^n[p\in\mathbf{P}\operatorname{or}\operatorname{lpf}p>\mathbf{P}_k]f(p)$，考虑容斥，有  

$$g_k(n)=
	g_{k-1}(n)-[\mathbf{P}_k^2\le n]
	g(\displaystyle\mathbf{P}_k)(g_{k-1}(\dfrac{n}{\mathbf{P}_k})-g_{k-1}(\mathbf{P}_{k-1}))$$
- $g_{k-1}(n)$ 表示不含前 $k-1$ 个质因子。
- $f(\mathbf{P}_k)(g_{k-1}(\dfrac{n}{\mathbf{P}_k})-\displaystyle g_{k-1}(\mathbf{P}_{k-1}))=\sum_{p=1}^n[\operatorname{lpf}p=\mathbf{P}_k]f(p)$，  
  表示除掉第 $k$ 个质因子。

$\mathbf{P}_k^2\ge n$ 时，$S_{\mathbf{P}}(n)=g_k(n)$。  
若 $g_0(n)$ 可快速计算，就可递推求解 $g_k(n)$。  
  


